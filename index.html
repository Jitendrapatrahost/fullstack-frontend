<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fullstack Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width:800px; margin:2rem auto; padding:1rem;}
    form { margin-bottom:1rem; }
    input, textarea { width:100%; padding:0.5rem; margin:0.25rem 0; }
    button { padding:0.5rem 1rem; }
    .post { border:1px solid #ccc; padding:0.75rem; margin-bottom:0.5rem; border-radius:6px;}
  </style>
</head>
<body>
  <h1>Fullstack test app</h1>
  <p>This page calls the backend API (Render) which stores data in Neon.</p>

  <form id="postForm">
    <input id="title" placeholder="Title" required />
    <textarea id="body" placeholder="Body" required rows="4"></textarea>
    <button type="submit">Create Post</button>
  </form>

  <div id="posts"></div>

  <script>
    // IMPORTANT: replace with your Render service URL (no trailing slash)
    const API_BASE = 'https://your-render-service.onrender.com';

    function escapeHtml(s) {
      if (!s) return '';
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
    }

    async function fetchPosts() {
      try {
        const res = await fetch(API_BASE + '/api/posts');
        const posts = await res.json();
        const container = document.getElementById('posts');
        container.innerHTML = posts.map(p =>
          `<div class="post"><h3>${escapeHtml(p.title)}</h3><p>${escapeHtml(p.body)}</p><small>${new Date(p.created_at).toLocaleString()}</small></div>`
        ).join('');
      } catch (err) {
        document.getElementById('posts').innerText = 'Error loading posts: ' + err.message;
      }
    }

    document.getElementById('postForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const title = document.getElementById('title').value.trim();
      const body = document.getElementById('body').value.trim();
      if (!title || !body) return alert('fill both');

      const res = await fetch(API_BASE + '/api/posts', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ title, body })
      });

      if (res.ok) {
        document.getElementById('title').value='';
        document.getElementById('body').value='';
        await fetchPosts();
      } else {
        const err = await res.json();
        alert('Error: ' + (err.error || 'unknown'));
      }
    });

    fetchPosts();
  </script>
</body>
</html>
